<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Safe Taxi</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f2f7fb;
      color: #333;
      line-height: 1.6;
    }

    header {
      background-color: #007bff;
      color: white;
      text-align: center;
      padding: 2rem 1rem;
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    main {
      max-width: 1100px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    section {
      background-color: white;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    section h2 {
      color: #007bff;
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }

    p, li {
      font-size: 1.1rem;
    }

    ul {
      padding-left: 1.5rem;
    }

    #map {
      width: 100%;
      height: 350px;
      border-radius: 12px;
      margin-bottom: 1rem;
    }

    button {
      background-color: #dc3545;
      color: white;
      padding: 0.8rem 1.2rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: background-color 0.3s;
      margin-top: 5px;
      margin-right: 5px;
    }

    button:hover {
      background-color: #c82333;
    }

    iframe {
      width: 100%;
      max-width: 850px;
      height: 450px;
      border-radius: 12px;
      border: 2px solid #007bff;
    }

    #geminiChat textarea {
      width: 100%;
      padding: 0.5rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 0.5rem;
      resize: none;
    }

    #geminiOutput {
      margin-top:10px;
      background:#f1f1f1;
      padding:10px;
      border-radius:8px;
      max-height:300px;
      overflow-y:auto;
    }

    footer {
      text-align: center;
      padding: 1.5rem;
      background-color: #007bff;
      color: white;
    }
  </style>
</head>
<body>
  <header>
    <h1>Safe Taxi</h1>
    <p>Your safety is our priority — Real-time tracking, emergency alerts, and secure rides for women and children.</p>
  </header>

  <main>
    <!-- Map Section -->
    <section id="mapSection">
      <h2>Live Map</h2>
      <div id="map"></div>
      <p>Track your ride in real-time and let your assigned driver locate you safely.</p>
    </section>

    <!-- Drivers Section -->
    <section id="drivers">
      <h2>Available Taxi Drivers</h2>
      <ul>
        <li><b>John Doe:</b> <a href="tel:+18091234567">Call</a></li>
        <li><b>Maria Lopez:</b> <a href="tel:+18099876543">Call</a></li>
        <li><b>David Johnson:</b> <a href="tel:+18093456789">Call</a></li>
      </ul>
    </section>

    <!-- Emergency Section -->
    <section id="emergencySection">
      <h2>Emergency</h2>
      <p>If you feel unsafe, press the button below to activate the alarm and alert nearby authorities.</p>
      <button id="emergencyBtn">Activate Emergency Alert</button>
      <audio id="alarm" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>
    </section>

    <!-- About Section -->
    <section id="about">
      <h2>About Safe Taxi</h2>
      <p>This website promotes the safety and confidence of women and children when boarding a taxi to avoid harassment.</p>
      <p>It includes a real-time map where passengers can indicate their location so that a verified driver can pick them up safely.</p>
      <p>Our system combines real-time tracking, emergency alerts, audible alarms, and AI chat assistants.</p>
    </section>

    <!-- Chatbot Section (HF Space) -->
    <section id="chatbot-container">
      <h2>AI Safety Assistant</h2>
      <iframe src="https://claribelgilsosa23-your-safe-taxi.hf.space" frameborder="0"></iframe>
    </section>

    <!-- Gemini API Chat Section -->
    <section id="geminiChat">
      <h2>AI Assistant (Gemini API)</h2>
      <div>
        <textarea id="geminiInput" placeholder="Escribe tu mensaje aquí..." rows="3"></textarea>
        <button id="geminiSend">Enviar</button>
      </div>
      <div id="geminiOutput"></div>
    </section>
  </main>

  <footer>
    <p>© 2025 Safe Taxi — Developed to protect what matters most</p>
    <p>Created by <a href="https://github.com/Claribel-Gilsosa" target="_blank">Claribel Gil Sosa</a></p>
  </footer>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Initialize Map
    const map = L.map('map').setView([18.5, -69.9], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Real-time location tracking
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          L.marker([lat, lon]).addTo(map)
            .bindPopup('Your current location')
            .openPopup();
          map.setView([lat, lon], 13);
        },
        () => { alert("Unable to get your current location."); }
      );
    } else {
      alert("Geolocation is not supported by this browser.");
    }

    // Emergency button logic
    const alarm = document.getElementById("alarm");
    document.getElementById("emergencyBtn").addEventListener("click", () => {
      alarm.play();
      alert("Emergency alert activated! Authorities have been notified.");
    });
  </script>

  <!-- Gemini API Chat Script -->
  <script>
    const geminiApiKey = "AIzaSyCkqCF6x3ppDhgm2HVC96qm4m74T0MeHNk"; // tu clave
    const geminiSendBtn = document.getElementById("geminiSend");
    const geminiInput = document.getElementById("geminiInput");
    const geminiOutput = document.getElementById("geminiOutput");

    async function sendGeminiMessage(message) {
      try {
        const response = await fetch("https://gen.googleapis.com/v1beta2/projects/gen-lang-client-0479254864:generateMessage", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${geminiApiKey}`
          },
          body: JSON.stringify({
            prompt: message,
            model: "gemini-1",
            temperature: 0.7
          })
        });

        const data = await response.json();
        const answer = data.candidates?.[0]?.content || "No response";
        const p = document.createElement("p");
        p.textContent = "Gemini: " + answer;
        geminiOutput.appendChild(p);
        geminiOutput.scrollTop = geminiOutput.scrollHeight;
      } catch (err) {
        console.error(err);
        const p = document.createElement("p");
        p.textContent = "Error al contactar Gemini API";
        geminiOutput.appendChild(p);
      }
    }

    geminiSendBtn.addEventListener("click", () => {
      const message = geminiInput.value.trim();
      if(message){
        const p = document.createElement("p");
        p.textContent = "Tú: " + message;
        geminiOutput.appendChild(p);
        geminiOutput.scrollTop = geminiOutput.scrollHeight;
        geminiInput.value = "";
        sendGeminiMessage(message);
      }
    });
  </script>
</body>
</html>